Global("UI", {})
Global("UI_SETTINGS", {})
Global("SETTING_GROUPS", {})
Global("SETTING_GROUPS_KEYS_ORDER", {})
Global("PANEL_WIDGETS", {})
Global("TABS", {})
Global("USER_SETTINGS", {})
Global("CALLBACKS", {})
Global("LANG", "rus")
Global("COLOR_PREVIEWS", {})
Global("LIST_LABELS", {})
Global("RENDER_CONDITIONS", {})
Global("COLOR_CLASSES", {
    ["DamageVisDp"] = true,
    ["Quest"] = true,
    ["CombatCyan"] = true,
    ["StatControl"] = true,
    ["WarningLogOrange"] = true,
    ["StatAdditionalColor"] = true,
    ["WarningLogYellow"] = true,
    ["EditLineCenterSmall"] = true,
    ["SecretCompleteFormat"] = true,
    ["EditLineGlobal"] = true,
    ["tip_blue"] = true,
    ["WarningLogBlue"] = true,
    ["StatFairyBonus"] = true,
    ["log_blue"] = true,
    ["DamageVisBuffGain"] = true,
    ["WarningLogRed"] = true,
    ["CombatRed"] = true,
    ["ColorWarmYellow"] = true,
    ["DamageVisExpGain"] = true,
    ["LogColorBlue"] = true,
    ["CombatBlue"] = true,
    ["EditLineSelectionCenterSmall"] = true,
    ["ColorWarmGreen"] = true,
    ["StatDebuffed"] = true,
    ["log_orange"] = true,
    ["log_yellow"] = true,
    ["calendar"] = true,
    ["StatUselessColor"] = true,
    ["ColorYellow"] = true,
    ["p2p"] = true,
    ["EpicCursed"] = true,
    ["QuestLogRed"] = true,
    ["tutorRed"] = true,
    ["LogColorLightRed"] = true,
    ["Label"] = true,
    ["tip_purple"] = true,
    ["YellowQuestName"] = true,
    ["IMPriceLocked"] = true,
    ["YellowQuestTimer"] = true,
    ["StatDefenceColor"] = true,
    ["ReputationEnemy"] = true,
    ["tutorGold"] = true,
    ["WarningLogWhite"] = true,
    ["CreditsText"] = true,
    ["Raid"] = true,
    ["SecretIncompleteFormat"] = true,
    ["RepConfidential"] = true,
    ["ColorDarkWarmGreen"] = true,
    ["RelicWithoutShadow"] = true,
    ["OutlineOnPaper"] = true,
    ["EditLineMoneyCountSelection"] = true,
    ["log_magenta"] = true,
    ["IMPrice"] = true,
    ["nav_avatar"] = true,
    ["body"] = true,
    ["ColorBlack"] = true,
    ["CombatLightYellow"] = true,
    ["DamageWhite"] = true,
    ["QuestLogGray"] = true,
    ["LabelCenterSmall8"] = true,
    ["EditLinePageCountSelection"] = true,
    ["ColorWarmRed"] = true,
    ["GrayQuestName"] = true,
    ["LabelCenterGoldSmall"] = true,
    ["tip_red"] = true,
    ["log_violet"] = true,
    ["DamageYellow"] = true,
    ["WarningLogGreen"] = true,
    ["CoinSettings"] = true,
    ["nav_enemy"] = true,
    ["SubscribeNormal"] = true,
    ["StatPrimaryColor"] = true,
    ["QuestLogNormal"] = true,
    ["p"] = true,
    ["tip_base"] = true,
    ["tip_white"] = true,
    ["ColorMagenta"] = true,
    ["Rare"] = true,
    ["DamageGreen"] = true,
    ["LogColorPink"] = true,
    ["log_brown"] = true,
    ["Common"] = true,
    ["RepKindly"] = true,
    ["DamageRed"] = true,
    ["Legendary"] = true,
    ["tutorGrey"] = true,
    ["WhiteQuestName"] = true,
    ["ReputationNeutral"] = true,
    ["default"] = true,
    ["ColorCian"] = true,
    ["StatUseless"] = true,
    ["CreditsHeader"] = true,
    ["ListItemSelected"] = true,
    ["LogColorMagenta"] = true,
    ["QuestFailedOnPaper"] = true,
    ["OnPaper"] = true,
    ["LogColorBlack"] = true,
    ["LegendaryCursed"] = true,
    ["tip_green"] = true,
    ["Subtitle"] = true,
    ["tutorCian"] = true,
    ["log_white"] = true,
    ["SecretInProgressFormat"] = true,
    ["ColorWhite"] = true,
    ["LogColorLightGreen"] = true,
    ["LegendaryWithoutShadow"] = true,
    ["QuestLogGreen"] = true,
    ["DamageBlue"] = true,
    ["RelicCursed"] = true,
    ["TabNormal"] = true,
    ["Golden"] = true,
    ["LabelCenterRedSmall8"] = true,
    ["DamageVisHpDrain"] = true,
    ["DamageVisHpGain"] = true,
    ["tutorLink"] = true,
    ["ColorMidWarmGreen"] = true,
    ["LabelCenterSmall"] = true,
    ["QuestLogBlue"] = true,
    ["tip_golden"] = true,
    ["ReputationKindly"] = true,
    ["log_light_yellow"] = true,
    ["ColorBlue"] = true,
    ["Goods"] = true,
    ["LogColorBrown"] = true,
    ["log_green"] = true,
    ["ColorGreen"] = true,
    ["LogColorSlateBlue"] = true,
    ["f2p"] = true,
    ["AllodsSystem"] = true,
    ["SubscribeWarning"] = true,
    ["tutorBlue"] = true,
    ["EditLineOnPaper"] = true,
    ["Neutral"] = true,
    ["QuestProgressPercent"] = true,
    ["alignRight"] = true,
    ["RepEnemy"] = true,
    ["EditLineGlobalCenter"] = true,
    ["GoodsCursed"] = true,
    ["LogColorWhite"] = true,
    ["CombatWhite"] = true,
    ["html"] = true,
    ["QuestCompleteOnPaper"] = true,
    ["br"] = true,
    ["PartyQuestName"] = true,
    ["AllodsFantasy"] = true,
    ["label"] = true,
    ["ColorLightBrown"] = true,
    ["bodysmall"] = true,
    ["alignJustify"] = true,
    ["HeaderOnPaper"] = true,
    ["RaidQuestName"] = true,
    ["tutorWhite"] = true,
    ["FullCollectionColor"] = true,
    ["DamageVisMpGain"] = true,
    ["Outline"] = true,
    ["navigator"] = true,
    ["DamageVisReputationGain"] = true,
    ["RedQuestTimer"] = true,
    ["LogColorGreen"] = true,
    ["CombatGreen"] = true,
    ["log"] = true,
    ["Aggressive"] = true,
    ["EditLineMailOnPaper"] = true,
    ["tip_button"] = true,
    ["Spouse"] = true,
    ["log_red"] = true,
    ["CommonCursed"] = true,
    ["tutorPurple"] = true,
    ["LogColorRed"] = true,
    ["EditLineSelection"] = true,
    ["StatAdditional"] = true,
    ["StatControlColor"] = true,
    ["log_dark_white"] = true,
    ["alignLeft"] = true,
    ["tutorGreen"] = true,
    ["StatBuffed"] = true,
    ["nav_friend"] = true,
    ["button"] = true,
    ["WhiteSubtask"] = true,
    ["EditLinePageCount"] = true,
    ["StatNormal"] = true,
    ["BlueQuestTimer"] = true,
    ["RepNeutral"] = true,
    ["LogColorOrange"] = true,
    ["IMPriceDisabled"] = true,
    ["LogColorYellow"] = true,
    ["StatDefence"] = true,
    ["GraySubtask"] = true,
    ["Relic"] = true,
    ["CollectionColor"] = true,
    ["log_dark_green"] = true,
    ["LogColorGold"] = true,
    ["ColorGray40"] = true,
    ["shortcut"] = true,
    ["disabled"] = true,
    ["ColorLightBeige"] = true,
    ["ColorGray50"] = true,
    ["Uncommon"] = true,
    ["Friendly"] = true,
    ["QuestLogOrange"] = true,
    ["ColorGray60"] = true,
    ["QuestLogYellow"] = true,
    ["DamageVisEnergyGain"] = true,
    ["nav_dead"] = true,
    ["RedQuestName"] = true,
    ["CombatOrange"] = true,
    ["TabSelected"] = true,
    ["Party"] = true,
    ["CombatYellow"] = true,
    ["Dead"] = true,
    ["RareCursed"] = true,
    ["RepFriendly"] = true,
    ["RepHostility"] = true,
    ["LabelCenterRedSmall"] = true,
    ["ReputationFriendly"] = true,
    ["tip_grey"] = true,
    ["ReputationHostility"] = true,
    ["LogColorViolet"] = true,
    ["RepUnfriendly"] = true,
    ["alignCenter"] = true,
    ["UncommonCursed"] = true,
    ["QuestProgressFullPercent"] = true,
    ["ListItemNormal"] = true,
    ["ColorRed"] = true,
    ["header"] = true,
    ["highlighted"] = true,
    ["TabDisabled"] = true,
    ["CoinSettingsRed"] = true,
    ["ReputationConfidential"] = true,
    ["EditLineMoneyCount"] = true,
    ["JunkCursed"] = true,
    ["GreenQuestName"] = true,
    ["DarkGreenQuestName"] = true,
    ["StatPrimary"] = true,
    ["Epic"] = true,
    ["log_cyan"] = true,
    ["LogColorCian"] = true,
    ["ReputationUnfriendly"] = true,
    ["nav_neutral"] = true,
    ["Junk"] = true,
})

local ITEM_SETTING_CB_POS = {
    {
        alignX = 0,
        posX = 371,
        highPosX = 0,
        alignY = 0,
        posY = 4,
        highPosY = 0,
    },
    {
        alignX = 0,
        posX = 471,
        highPosX = 0,
        alignY = 0,
        posY = 4,
        highPosY = 0,
    },
    {
        alignX = 0,
        posX = 371,
        highPosX = 0,
        alignY = 1,
        posY = 0,
        highPosY = 6,
    },
    {
        alignX = 0,
        posX = 471,
        highPosX = 0,
        alignY = 1,
        posY = 0,
        highPosY = 6,
    },
}

local ITEM_SETTING_CB_POS_6 = {
    {
        alignX = 0,
        posX = 295,
        highPosX = 0,
        alignY = 0,
        posY = 4,
        highPosY = 0,
    },
    {
        alignX = 0,
        posX = 385,
        highPosX = 0,
        alignY = 0,
        posY = 4,
        highPosY = 0,
    },
    {
        alignX = 0,
        posX = 475,
        highPosX = 0,
        alignY = 0,
        posY = 4,
        highPosY = 0,
    },
    {
        alignX = 0,
        posX = 295,
        highPosX = 0,
        alignY = 1,
        posY = 0,
        highPosY = 6,
    },
    {
        alignX = 0,
        posX = 385,
        highPosX = 0,
        alignY = 1,
        posY = 0,
        highPosY = 6,
    },
    {
        alignX = 0,
        posX = 475,
        highPosX = 0,
        alignY = 1,
        posY = 0,
        highPosY = 6,
    },
}

local ACTIVE_BUTTONS = {}
local CURRENT_TAB = nil
local SettingsMainFrame = mainForm:GetChildChecked("SettingsMain", false)

-- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
-- =-                  U T I L S                  -=
-- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

function GetLocaleText(name)
    if not LOCALES then
        return name
    end

    local lang = LANG or "rus"

    local l = LOCALES[lang]

    if l then
        return l[name] or name
    else
        return name
    end
end

local function tabContainsGroup(tabs, tab, group)
    for i, t in pairs(tabs) do
        if (t and t.label == tab) then
            return contains(t.groups, group)
        end
    end

    return false
end

local function getTab(tabs, label)
    for i, t in pairs(tabs) do
        if (t and t.label == label) then
            return t
        end
    end

    return nil
end

local function printSettings()
    for k, v in pairs(UI_SETTINGS) do
        Log("|___ " .. (k) .. " = " .. tostring(v.value))
    end
end

local function saveSettings()
    userMods.SetGlobalConfigSection("UI_SETTINGS", UI_SETTINGS)
end

local function getConfigIcon(e)
    local icon
    if (e.buffId) then
        local info = object.GetBuffInfo(e.buffId) or avatar.GetBuffInfoById(e.buffId)
        if (info ~= nil) then
            if (info.texture) then
                icon = info.texture
            elseif (info.producer and info.producer.spellId) then
                icon = spellLib.GetIcon(info.producer.spellId)
            end
        end
    end
    if (not icon and e.spellId) then
        icon = spellLib.GetIcon(e.spellId)
    end
    if (not icon and e.abilityId) then
        local info = avatar.GetAbilityInfo(e.abilityId)
        if (info and info.texture) then icon = info.texture end
    end
    if (not icon and e.mapModifierId) then
        local info = cartographer.GetMapModifierInfo(e.mapModifierId)
        if (info and info.image) then icon = info.image end
    end

    return icon
end
-- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
-- =- S E T T I N G S   C H A N G E   E V E N T S -=
-- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

local function onListButtonClick(params)
    if params.active then
        local settings = UI_SETTINGS[params.sender]
        if (params.sender and settings) then
            local index = settings.index

            if (params.name == "setting_list_button_left") then
                index = index - 1
                if (not settings.cycle and index < 1) then return end
                if (index < 1) then index = #(settings.options) end
            else
                index = index + 1
                if (not settings.cycle and index > #(settings.options)) then return end

                if (index > #(settings.options)) then index = 1 end
            end

            settings.widgets.lBtn:Enable(settings.cycle or index > 1)
            settings.widgets.rBtn:Enable(settings.cycle or index < #(settings.options))

            local tmp = tostring(settings.options[index])
            UI_SETTINGS[params.sender].value = tmp
            UI_SETTINGS[params.sender].index = index

            if (COLOR_CLASSES and COLOR_CLASSES[tmp]) then
                settings.widgets.value:SetClassVal("class", tmp)
            else
                settings.widgets.value:SetClassVal("class", "tip_white")
                tmp = GetLocaleText(tmp)
            end

            settings.widgets.value:SetVal("text", tmp)

            saveSettings()

            if (LIST_LABELS[params.sender]) then
                LIST_LABELS[params.sender].widget:SetVal("simplelabel_text",
                    GetLocaleText(tostring(LIST_LABELS[params.sender].labels[index])))
            end

            if (CALLBACKS[params.sender] and type(CALLBACKS[params.sender]) == "function") then
                CALLBACKS[params.sender](UI_SETTINGS[params.sender].value, params.sender)
            end

            if (RENDER_CONDITIONS[params.sender] ~= nil) then
                UI.render()
            end
        end
    end
end

local function onCheckboxClick(params)
    if params.active then
        if (params.sender and UI_SETTINGS[params.sender]) then
            UI_SETTINGS[params.sender].value = not UI_SETTINGS[params.sender].value
            params.widget:SetVariant(ToVariant(UI_SETTINGS[params.sender].value))
            saveSettings()

            if (CALLBACKS[params.sender] and type(CALLBACKS[params.sender]) == "function") then
                CALLBACKS[params.sender](UI_SETTINGS[params.sender].value, params.sender)
            end
        end
    end
end

local function onInputChange(params)
    if (params.sender and UI_SETTINGS[params.sender]) then
        local tempVal = params.widget:GetString()

        if (UI_SETTINGS[params.sender].filter == "_NUM") then
            tempVal = tostring(ExtractFloatFromString(tempVal))
            params.widget:SetText(ToWS(tempVal))
        end

        UI_SETTINGS[params.sender].value = tempVal
        saveSettings()

        if (CALLBACKS[params.sender] and type(CALLBACKS[params.sender]) == "function") then
            CALLBACKS[params.sender](UI_SETTINGS[params.sender].value, params.sender)
        end
    end

    params.widget:SetFocus(false)
end

local function onInputEsc(params)
    if (params.widget) then
        onInputChange(params)
        params.widget:SetFocus(false)
    end
end

local function onInputFocus(params)
    if (not params.active) then
        onInputChange(params)
    end
end

local function updateColorPreview(name, icon)
    if (UI_SETTINGS[name .. "_r"] and UI_SETTINGS[name .. "_g"] and UI_SETTINGS[name .. "_b"]) then
        local alpha = 1.0
        if (UI_SETTINGS[name .. "_a"]) then alpha = UI_SETTINGS[name .. "_a"].value / 100 end
        icon:SetBackgroundColor({
            r = UI_SETTINGS[name .. "_r"].value / 255,
            g = UI_SETTINGS[name .. "_g"].value / 255,
            b = UI_SETTINGS[name .. "_b"].value / 255,
            a = alpha
        })
    else
        icon:SetBackgroundColor({ r = 0, g = 0, b = 0, a = 0 })
    end
end

local function onSliderChange(params)
    if (params.sender and UI_SETTINGS[params.sender]) then
        local descPanel = params.widget:GetParent():GetParent()
        local label = descPanel:GetChildChecked("SliderPanelBarText", true)
        local value = params.widget:GetPos()

        label:SetVal("text", tostring(value + (UI_SETTINGS[params.sender].offset or 0)))

        UI_SETTINGS[params.sender].value = value
        saveSettings()

        if (CALLBACKS[params.sender] and type(CALLBACKS[params.sender]) == "function") then
            CALLBACKS[params.sender](UI_SETTINGS[params.sender].value + (UI_SETTINGS[params.sender].offset or 0),
                params.sender)
        end

        -- if ends with _r, _g, _b, _a then update color preview
        local name = params.sender
        if (name:sub(-2) == "_r" or name:sub(-2) == "_g" or name:sub(-2) == "_b" or name:sub(-2) == "_a") then
            name = name:sub(1, -3)
            if (COLOR_PREVIEWS[name]) then
                updateColorPreview(name, COLOR_PREVIEWS[name])
            end
        end
    end
end

local function onSettingButton(params)
    if (params.sender and UI_SETTINGS[params.sender]) then
        local cb = UI_SETTINGS[params.sender].callback
        if (cb and type(cb) == "function") then
            cb(params.widget, UI_SETTINGS[params.sender])
        end
    end
end

local function onSettingButtonInput(params)
    if (params.sender and UI_SETTINGS[params.sender]) then
        local cb = UI_SETTINGS[params.sender].callback
        local editline = params.widget:GetParent():GetChildChecked("EditLine", true)
        if (cb and type(cb) == "function") then
            cb(params.widget, UI_SETTINGS[params.sender], editline)
        end
    end
end

local function onMainAccept()
    saveSettings()
    -- UI.toggle()
end

local function onMainRestore()
    -- userMods.SetGlobalConfigSection("UI_SETTINGS", {})
    -- UI_SETTINGS = {}

    for k, v in pairs(UI_SETTINGS) do
        local split_string = {}
        for w in k:gmatch('([^_]+)') do table.insert(split_string, w) end

        if (TABS and not tabContainsGroup(TABS, CURRENT_TAB, split_string[1])) then goto continue end

        if (v and v.type) then
            if (v.type == "Checkbox" or v.type == "Input") then
                UI_SETTINGS[k].value = v.defaultValue
            elseif (v.type == "Slider") then
                UI_SETTINGS[k].value = v.defaultValue
            elseif (v.type == "List") then
                UI_SETTINGS[k].index = v.defaultIndex
                UI_SETTINGS[k].value = v.options[v.defaultIndex]
            elseif (v.type == "Button") then
                UI_SETTINGS[k].state = v.defaultState
                UI_SETTINGS[k].value = v.states[v.defaultState]
            end
        end
        ::continue::
    end

    UI.render()
end

local function onTabSwitch(params)
    if (not params.sender) then return end
    local split_string = {}
    for w in params.sender:gmatch('([^_]+)') do table.insert(split_string, w) end

    if (split_string[2]) then
        for i, t in pairs(TABS) do
            if (t.widget) then
                t.widget:SetVariant(0)
            end
        end

        CURRENT_TAB = split_string[2]
        params.widget:SetVariant(1)
        UI.render()
    end
end

local function onItemSettingEnable(params)
    local id = params.widget:GetParent():GetName()

    if (id and UI_SETTINGS[id]) then
        UI_SETTINGS[id].value = not UI_SETTINGS[id].value
        params.widget:SetVariant(ToVariant(UI_SETTINGS[id].value))
        saveSettings()
    end
end

local function onItemSettingDelete(params)
    local id = params.widget:GetParent():GetName()
    local split_string = {}
    for w in id:gmatch('([^_]+)') do table.insert(split_string, w) end

    if (id and UI_SETTINGS[id]) then
        UI_SETTINGS[id].value = false
        saveSettings()

        UI.groupPop(split_string[1], split_string[2])
        UI.render()
    end
end

local function onItemSettingCB(params)
    local id = params.widget:GetParent():GetName()

    if (id and UI_SETTINGS[id] and UI_SETTINGS[id].cb[params.sender] ~= nil) then
        UI_SETTINGS[id].cb[params.sender] = not UI_SETTINGS[id].cb[params.sender]
        params.widget:SetVariant(ToVariant(UI_SETTINGS[id].cb[params.sender]))
        saveSettings()
    end
end

-- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
-- =-                   I N I T                   -=
-- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

function UI.init(name)
    CALLBACKS = {}
    COLOR_PREVIEWS = {}
    LIST_LABELS = {}
    RENDER_CONDITIONS = {}

    common.RegisterReactionHandler(onCheckboxClick, "setting_cb")
    common.RegisterReactionHandler(onListButtonClick, "setting_list_button_left")
    common.RegisterReactionHandler(onListButtonClick, "setting_list_button_right")
    common.RegisterReactionHandler(onInputChange, "setting_input_change")
    common.RegisterReactionHandler(onInputEsc, "setting_input_esc")
    common.RegisterReactionHandler(onSliderChange, "setting_slider")
    common.RegisterReactionHandler(onSettingButton, "setting_button")
    common.RegisterReactionHandler(onMainAccept, "main_accept_pressed")
    common.RegisterReactionHandler(onMainRestore, "main_restore_pressed")
    common.RegisterReactionHandler(onTabSwitch, "tab_pressed")
    common.RegisterReactionHandler(onItemSettingEnable, "setting_itemsetting_enable")
    common.RegisterReactionHandler(onItemSettingCB, "setting_itemsetting_cb")
    common.RegisterReactionHandler(onSettingButtonInput, "setting_buttoninput")
    common.RegisterReactionHandler(onItemSettingDelete, "setting_itemsetting_delete")
    common.RegisterReactionHandler(onInputFocus, "setting_input_focus")

    local config = userMods.GetGlobalConfigSection("UI_SETTINGS")
    if (config and len(config) > 0) then UI_SETTINGS = config end

    if (not UI_SETTINGS.registeredTextures) then UI_SETTINGS.registeredTextures = {} end

    local frameHeader = SettingsMainFrame:GetChildChecked("WindowHeader", true)
    if (not name) then name = "Settings" end
    frameHeader:GetChildChecked("HeaderText", true):SetVal("header", name)

    frameHeader:SetTransparentInput(false)
    DnD.Init(SettingsMainFrame, frameHeader)
    DnD.Enable(SettingsMainFrame, false)
end

function UI.get(group, name)
    local id = group .. "_" .. name

    if (UI_SETTINGS[id]) then
        if (UI_SETTINGS[id].offset) then
            return UI_SETTINGS[id].value + UI_SETTINGS[id].offset
        end
        return UI_SETTINGS[id].value
    end

    return nil
end

function UI.getItem(group, item)
    local id = group .. "_" .. item

    if (UI_SETTINGS[id]) then
        local tmp = {
            enabled = UI_SETTINGS[id].value
        }
        for k, v in pairs(UI_SETTINGS[id].cb) do
            tmp[k] = v
        end

        return tmp
    end

    return nil
end

function UI.getGroupColor(group)
    local r = group .. "_r"
    local g = group .. "_g"
    local b = group .. "_b"
    local a = group .. "_a"

    if (UI_SETTINGS[r] and UI_SETTINGS[g] and UI_SETTINGS[b] and UI_SETTINGS[a]) then
        return {
            r = tonumber(UI_SETTINGS[r].value) / 255.0,
            g = tonumber(UI_SETTINGS[g].value) / 255.0,
            b = tonumber(UI_SETTINGS[b].value) / 255.0,
            a = tonumber(UI_SETTINGS[a].value) / 100.0,
        }
    end

    return nil
end

function UI.getClassList(canBeNil)
    local tmp = {}
    if (canBeNil) then table.insert(tmp, "-") end

    local _common = {
        "ColorWhite",
        "DamageYellow",
        "DamageRed",
        "ColorWarmGreen",
        "DamageGreen",
        "Junk",
        "JunkCursed",
        "Common",
        "CommonCursed",
        "Uncommon",
        "UncommonCursed",
        "Rare",
        "RareCursed",
        "Epic",
        "EpicCursed",
        "Legendary",
        "LegendaryCursed",
        "Relic",
        "RelicCursed",

        "Golden",
        "Spouse",
        "IMPrice",
        "IMPriceDisabled",
        "IMPriceLocked",
        "SubscribeWarning",
    }

    for k, v in pairs(_common) do
        table.insert(tmp, v)
    end

    for k, v in pairs(sortedKeys(COLOR_CLASSES)) do
        if (starts(v, "Damage") and not contains(tmp, v)) then
            table.insert(tmp, v)
        end
    end

    return tmp
end

function UI.registerTexture(key, obj)
    if UI_SETTINGS.registeredTextures[key] ~= nil then return end

    UI_SETTINGS.registeredTextures[key] = {
        obj = obj,
        spellId = obj.spellId,
        buffId = obj.buffId,
        abilityId = obj.abilityId,
        mapModifierId = obj.mapModifierId
    }

    saveSettings()
end

function UI.save()
    saveSettings()
end

function UI.print()
    printSettings()
end

function UI.dnd(value)
    DnD.Enable(SettingsMainFrame, value)
end

function UI.toggle()
    local ui = mainForm:GetChildChecked("SettingsMain", false)
    local show = not ui:IsVisibleEx()
    ui:Show(show)
    WtSetPlace(ui, { alignX = 2, alignY = 2 })
    if (show) then
        UI.render()
    end
end

function UI.chore()
    userMods.SetGlobalConfigSection("UI_SETTINGS", {})
    UI_SETTINGS = {}
end

-- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
-- =-          U I   G E N E R A T O R S          -=
-- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

function UI.withCallback(UISetting, callback)
    if (callback) then
        UISetting.callback = callback
    end
    return UISetting
end

function UI.withCondition(UISetting, setting, value)
    UISetting.condition = {
        setting = setting,
        value = value
    }
    return UISetting
end

function UI.withCustomClass(UISetting, class)
    UISetting.customClass = class
    return UISetting
end

function UI.createCheckBox(name, default)
    local label = GetLocaleText("SETTING_" .. name)

    local temp = { name = name, label = label, type = "Checkbox", params = {} }

    if (default == nil) then default = false end

    temp.params.value = default
    temp.params.defaultValue = default

    return temp
end

function UI.createColorGroup(name, default)
    UI.addGroup(name, {
        UI.createColorPreview(name, "ColorPreview"),
        UI.createSlider("r", {
            stepsCount = 255,
            width = 212,
        }, default.r or 0),
        UI.createSlider("g", {
            stepsCount = 255,
            width = 212,
        }, default.g or 0),
        UI.createSlider("b", {
            stepsCount = 255,
            width = 212,
        }, default.b or 0),
        UI.createSlider("a", {
            stepsCount = 100,
            width = 212,
        }, default.a or 100),
    })
end

function UI.createColorPreview(name, label)
    local temp = { name = name, label = GetLocaleText(tostring(label)), type = "ColorPreview", params = {} }
    return temp
end

function UI.createSimpleLabel(label)
    local temp = { name = label, label = label, type = "SimpleLabel", params = {} }
    return temp
end

function UI.createListLabel(listName, labels)
    local temp = {
        name = listName,
        label = labels[1],
        type = "ListLabel",
        params = {
            labels = labels,
        }
    }
    return temp
end

function UI.createList(name, options, default, cycle)
    local label = GetLocaleText("SETTING_" .. name)

    local temp = {
        name = name,
        label = label,
        type = "List",
        params = {
            options = options,
        }
    }

    if (default == nil or default < 1) then default = 1 end
    if (default > #options) then default = #options end

    temp.params.value = options[default]
    temp.params.defaultIndex = default
    temp.params.index = default
    temp.params.cycle = cycle

    return temp
end

function UI.createSlider(name, options, default)
    if (options.offset == nil) then options.offset = 0 end

    local label = GetLocaleText("SETTING_" .. name)
    local temp = {
        name = name,
        label = label,
        type = "Slider",
        params = {
            options = {
                stepsCount = options.stepsCount or 10,
                width = options.width or 212,
                offset = options.offset,
            },
        }
    }

    if (default == nil) then default = 0 end
    if (default - options.offset > options.stepsCount) then default = options.stepsCount end

    temp.params.value = default - options.offset
    temp.params.defaultValue = default - options.offset

    return temp
end

function UI.createInput(name, options, default)
    local label = GetLocaleText("SETTING_" .. name)
    local temp = {
        name = name,
        label = label,
        type = "Input",
        params = {
            options = {
                isPassword = options.isPassword or false,
                maxChars = options.maxChars or nil,
                width = options.width or (options.maxChars and options.maxChars * 12 + 10) or 100,
                filter = options.filter or ""
            },
        }
    }

    if (default == nil) then default = "" end

    temp.params.value = default
    temp.params.defaultValue = default

    return temp
end

function UI.createButtonInput(name, options, default)
    local label = GetLocaleText("SETTING_" .. name)

    local temp = {
        name = name,
        label = label,
        type = "ButtonInput",
        params = {
            callback = options.callback,
            states = options.states,
            options = {
                width = options.width or 100,
            },
        }
    }

    if (default == nil or default < 1) then default = 1 end
    if (default > #(options.states)) then default = #(options.states) end

    temp.params.value = options.states[default]
    temp.params.defaultState = default
    temp.params.state = default

    return temp
end

function UI.createButton(name, options, default)
    local label = GetLocaleText("SETTING_" .. name)

    local temp = {
        name = name,
        label = label,
        type = "Button",
        params = {
            callback = options.callback,
            states = options.states,
            options = {
                width = options.width or 100,
            },
        }
    }

    if (default == nil or default < 1) then default = 1 end
    if (default > #(options.states)) then default = #(options.states) end

    temp.params.value = options.states[default]
    temp.params.defaultState = default
    temp.params.state = default

    return temp
end

-- name - string
-- label - string
-- options - {
--  iconName, checkboxes = { { name, label, default }}
-- }
function UI.createItemSetting(name, options, enabled)
    local label = name

    local temp = {
        name = name,
        label = label,
        type = "ItemSetting",
        params = {
            options = {},
            iconName = options.iconName or "_Placeholder_",
            enabled = enabled,
            static = options.static
        }
    }

    for k, v in pairs(options.checkboxes) do
        local cb = {
            name = v.name,
            label = GetLocaleText(v.label),
            value = v.default
        }

        table.insert(temp.params.options, cb)
    end

    return temp
end

function UI.loadUserSettings()
    USER_SETTINGS = userMods.GetGlobalConfigSection("USER_SETTINGS") or {}
    for group_name, list in pairs(USER_SETTINGS) do
        if (#list > 0) then
            for i, setting in pairs(list) do
                UI.groupPush(group_name, setting, false)
            end
        end
    end
end

function UI.tabPush(groupName, tabName)
    if (TABS and not tabContainsGroup(TABS, CURRENT_TAB, groupName)) then
        -- table.insert(TABS[CURRENT_TAB].groups, groupName)
        local tabIndex = 1
        for i, tab in pairs(TABS) do
            if (tab.label == tabName) then
                tabIndex = i
                break
            end
        end

        if (not TABS[tabIndex].groups) then
            TABS[tabIndex].groups = {}
        end

        table.insert(TABS[tabIndex].groups, groupName)
    end
end

function UI.groupPush(name, setting, user)
    -- if name is just whitespace, ignore it
    if (setting.name:match("^%s*$")) then return end
    if (SETTING_GROUPS[name]) then
        if (user) then
            if (not USER_SETTINGS[name]) then
                USER_SETTINGS[name] = {}
            else
                for k, v in pairs(USER_SETTINGS[name]) do
                    if (v and v.name == setting.name) then
                        return
                    end
                end
            end
            table.insert(USER_SETTINGS[name], setting)
            userMods.SetGlobalConfigSection("USER_SETTINGS", USER_SETTINGS)
        end
        table.insert(SETTING_GROUPS[name].settings, setting)
    end
end

function UI.groupPop(name, settingName)
    if (SETTING_GROUPS[name]) then
        for k, v in pairs(SETTING_GROUPS[name].settings) do
            if (v and v.name == settingName) then
                table.remove(SETTING_GROUPS[name].settings, k)
            end
        end

        if (USER_SETTINGS[name]) then
            for k, v in pairs(USER_SETTINGS[name]) do
                if (v and v.name == settingName) then
                    table.remove(USER_SETTINGS[name], k)
                end
            end
            userMods.SetGlobalConfigSection("USER_SETTINGS", USER_SETTINGS)
        end
    end
end

function UI.addGroup(name, settings, customLabel)
    local label = GetLocaleText("GROUP_" .. name)
    if (customLabel) then label = customLabel end

    SETTING_GROUPS[name] = {
        label = label,
        settings = settings
    }
    table.insert(SETTING_GROUPS_KEYS_ORDER, name)
end

function UI.removeGroup(name)
    SETTING_GROUPS[name] = nil
    for k, v in pairs(SETTING_GROUPS_KEYS_ORDER) do
        if (v == name) then
            table.remove(SETTING_GROUPS_KEYS_ORDER, k)
        end
    end
end

function UI.setTabs(tabs, default)
    TABS = tabs
    CURRENT_TAB = default

    local settingsPanel = mainForm:GetChildChecked("SettingsMain", true)
    local tabTemplate = settingsPanel:GetChildChecked("TabTemplate", false)
    local i = 0
    for k, v in pairs(tabs) do
        local label = v.label
        local tab = CreateWG("TabTemplate", "Tab_" .. label, settingsPanel, true,
            { posX = i * 120 + 35 })

        tab:Show(true)
        tab:Enable(true)
        tab:SetVal("tab_label", ToWS(GetLocaleText("TAB_" .. label)))
        tab:SetVariant(0)
        if (label == default) then tab:SetVariant(1) end
        i = i + 1

        TABS[k].widget = tab
    end
end

-- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
-- =-                 R E N D E R                 -=
-- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

function UI.render()
    local scrollCont = mainForm:GetChildChecked("OptionsContainer", true)
    local minPosY = 16
    local maxW = 575

    for index, active_btn in pairs(ACTIVE_BUTTONS) do
        active_btn:Show(false)
    end

    ACTIVE_BUTTONS = {}

    local tabSettings = getTab(TABS, CURRENT_TAB)
    if (tabSettings) then
        if (tabSettings.buttons) then
            if (tabSettings.buttons.left) then
                for i, v in pairs(tabSettings.buttons.left) do
                    local button = SettingsMainFrame:GetChildChecked("Button" .. (v), false)
                    if (button) then
                        button:Show(true)
                        button:SetVal("label", ToWS(GetLocaleText("Button" .. (v))))

                        WtSetPlace(button, { alignX = 0, posX = (35 + (i - 1) * 115) })
                        table.insert(ACTIVE_BUTTONS, button)
                    end
                end
            end
            if (tabSettings.buttons.right) then
                for i, v in pairs(tabSettings.buttons.right) do
                    local button = SettingsMainFrame:GetChildChecked("Button" .. (v), false)
                    if (button) then
                        button:Show(true)
                        button:SetVal("label", ToWS(GetLocaleText("Button" .. (v))))

                        WtSetPlace(button, { alignX = 1, highPosX = (45 + (i - 1) * 115) })

                        table.insert(ACTIVE_BUTTONS, button)
                    end
                end
            end
        end
    end

    -- reset scroll content
    scrollCont:RemoveItems()

    for _index, _key in pairs(SETTING_GROUPS_KEYS_ORDER) do
        local group_name = _key
        local group = SETTING_GROUPS[_key]
        if (not group) then return end
        local TAB_SHOW = true
        if (TABS and not tabContainsGroup(TABS, CURRENT_TAB, group_name)) then TAB_SHOW = false end

        local settings = group.settings
        local grouplabel = group.label
        local frameH = ((#settings) * 45) + 30
        local extraPadding = 0

        local groupFrameDest = mainForm:GetChildUnchecked(grouplabel, false)
        local groupFrame = nil
        if (groupFrameDest) then
            groupFrame = groupFrameDest
            for k, v in pairs(groupFrame:GetNamedChildren()) do
                if (v ~= nil and v:GetName() ~= "GroupHeader") then
                    v:DestroyWidget()
                end
            end
        else
            groupFrame = CreateWG("BackFrame", grouplabel, mainForm, true,
                { alignX = 3, posX = 0, highPosX = 0, alignY = 0, sizeY = frameH })
        end

        groupFrame:Show(true)

        local header = groupFrame:GetChildChecked("GroupHeader", false):GetChildChecked("HeaderText", false)
        header:SetVal("name", grouplabel)

        local verticalIndex = -1
        for i = 1, #settings, 1 do
            local v = settings[i]
            verticalIndex = verticalIndex + 1
            if (v and v.type) then
                local id = group_name .. "_" .. v.name
                if (v.callback) then
                    CALLBACKS[id] = v.callback
                end
                if (v.condition) then
                    local setting_id = group_name .. "_" .. v.condition.setting
                    RENDER_CONDITIONS[setting_id] = v.condition.value
                    if (UI_SETTINGS[setting_id] and UI_SETTINGS[setting_id].value ~= v.condition.value) then
                        frameH = frameH - 45
                        WtSetPlace(groupFrame, { sizeY = frameH })
                        verticalIndex = verticalIndex - 1
                        goto renderContinue
                    end
                end
                -- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
                -- =-               C H E C K B O X               -=
                -- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
                if (v.type == "Checkbox") then
                    local panel = CreateWG("CheckboxPanel", "CheckboxPanel", groupFrame, true,
                        {
                            alignX = 2,
                            posX = 1,
                            sizeX = maxW,
                            posY = minPosY + verticalIndex * 45 + extraPadding,
                            highPosX = 0,
                            alignY = 0
                        })
                    local button = panel:GetChildChecked("Checkbox", false)
                    local label = panel:GetChildChecked("CheckboxPanelText", false)
                    groupFrame:AddChild(panel)
                    if (v.customClass ~= nil) then
                        label:SetClassVal("class", v.customClass)
                    else
                        label:SetClassVal("class", "Golden")
                    end
                    button:SetName(id)
                    label:SetVal("checkbox_text", v.label)

                    if (not UI_SETTINGS[id]) then
                        UI_SETTINGS[id] = { type = v.type, value = v.params.value, defaultValue = v.params.defaultValue }
                    end

                    button:SetVariant(ToVariant(UI_SETTINGS[id].value))
                    -- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
                    -- =-             L I S T   L A B E L             -=
                    -- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
                elseif (v.type == "ListLabel") then
                    local panel = CreateWG("SimpleLabelPanel", "SimpleLabelPanel", groupFrame, true,
                        {
                            alignX = 2,
                            posX = 1,
                            sizeX = maxW,
                            posY = minPosY + verticalIndex * 45 + extraPadding,
                            highPosX = 0,
                            alignY = 0
                        })
                    local label = panel:GetChildChecked("SimpleLabelPanelText", false)
                    groupFrame:AddChild(panel)
                    if (UI_SETTINGS[id] and UI_SETTINGS[id].index) then
                        label:SetVal("simplelabel_text", GetLocaleText(tostring(v.params.labels[UI_SETTINGS[id].index])))
                    else
                        label:SetVal("simplelabel_text", GetLocaleText("Err"))
                    end

                    if (v.customClass ~= nil) then
                        label:SetClassVal("class", v.customClass)
                    else
                        label:SetClassVal("class", "Golden")
                    end

                    LIST_LABELS[id] = { widget = label, labels = v.params.labels }
                    -- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
                    -- =-           S I M P L E   L A B E L           -=
                    -- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
                elseif (v.type == "SimpleLabel") then
                    local panel = CreateWG("SimpleLabelPanel", "SimpleLabelPanel", groupFrame, true,
                        {
                            alignX = 2,
                            posX = 1,
                            sizeX = maxW,
                            posY = minPosY + verticalIndex * 45 + extraPadding,
                            highPosX = 0,
                            alignY = 0
                        })
                    local label = panel:GetChildChecked("SimpleLabelPanelText", false)
                    groupFrame:AddChild(panel)
                    if (v.customClass ~= nil) then
                        label:SetClassVal("class", v.customClass)
                    else
                        label:SetClassVal("class", "Golden")
                    end
                    label:SetVal("simplelabel_text", GetLocaleText(tostring(v.label)))
                    -- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
                    -- =-          C O L O R   P R E V I E W          -=
                    -- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
                elseif (v.type == "ColorPreview") then
                    local panel = CreateWG("ColorPreviewPanel", "ColorPreviewPanel", groupFrame, true,
                        {
                            alignX = 2,
                            posX = 1,
                            sizeX = maxW,
                            posY = minPosY + verticalIndex * 45 + extraPadding,
                            highPosX = 0,
                            alignY = 0
                        })
                    local label = panel:GetChildChecked("ColorPreviewPanelText", false)
                    groupFrame:AddChild(panel)
                    label:SetVal("colorpreview_text", v.label)
                    if (v.customClass ~= nil) then
                        label:SetClassVal("class", v.customClass)
                    else
                        label:SetClassVal("class", "Golden")
                    end
                    local icon = panel:GetChildChecked("ColorPreviewIcon", false)
                    COLOR_PREVIEWS[v.name] = icon
                    updateColorPreview(v.name, icon)

                    -- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
                    -- =-           I T E M S E T T I N G S           -=
                    -- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
                elseif (v.type == "ItemSetting") then
                    local panel = CreateWG("ItemSettingPanel", "ItemSettingPanel", groupFrame, true,
                        {
                            alignX = 2,
                            posX = 1,
                            sizeX = maxW,
                            posY = minPosY + verticalIndex * 45 + extraPadding,
                            highPosX = 0,
                            alignY = 0
                        })
                    local enable = panel:GetChildChecked("EnableCheckbox", false)
                    local label = panel:GetChildChecked("ItemSettingPanelText", false)
                    local btnDelete = panel:GetChildChecked("ButtonDelete", false)
                    extraPadding = extraPadding + 22
                    WtSetPlace(groupFrame, { sizeY = frameH + extraPadding })
                    groupFrame:AddChild(panel)
                    panel:SetName(id)
                    if (v.customClass ~= nil) then
                        label:SetClassVal("class", v.customClass)
                    else
                        label:SetClassVal("class", "Golden")
                    end
                    label:SetVal("text", v.label)

                    if (btnDelete) then
                        if (v.params.static) then btnDelete:Show(false) end
                        btnDelete:SetVal("label", ToWS(GetLocaleText("ButtonDelete")))
                    end

                    local icon = panel:GetChildChecked("IconSpell", false)

                    if (UI_SETTINGS.registeredTextures[v.label]) then
                        local texture = getConfigIcon(UI_SETTINGS.registeredTextures[v.label])
                        if (texture ~= nil) then
                            if (icon ~= nil) then
                                icon:SetBackgroundTexture(texture)
                            end
                        end
                    else
                        local texture = GetGroupTexture("RELATED_TEXTURES", v.params.iconName)
                        if (texture ~= nil) then
                            if (icon ~= nil) then
                                icon:SetBackgroundTexture(texture)
                            end
                        end
                    end

                    if (not UI_SETTINGS[id]) then
                        UI_SETTINGS[id] = { type = v.type, value = v.params.enabled, cb = {} }
                    end

                    for i = 1, #(v.params.options), 1 do
                        local option = v.params.options[i]
                        local cb = panel:GetChildChecked("CB_" .. tostring(i), false)
                        local label = panel:GetChildChecked("Text_" .. tostring(i), false)

                        if (cb and option) then
                            label:SetVal("text", option.label)
                            cb:SetName(option.name)
                            cb:Show(true)

                            if (#(v.params.options) == 2) then
                                WtSetPlace(cb, { alignY = 2, posY = 2, highPosY = 0 })
                                WtSetPlace(label, { alignY = 2, posY = 2, highPosY = 0 })
                            elseif (#(v.params.options) == 1) then
                                local tmp = ITEM_SETTING_CB_POS[2]
                                WtSetPlace(cb, { alignY = 2, posY = 2, highPosY = 0, posX = tmp.posX })
                                WtSetPlace(label, { alignY = 2, posY = 2, highPosY = 0, posX = tmp.posX + 31 })
                            elseif (#(v.params.options) == 6) then
                                local tmp = ITEM_SETTING_CB_POS_6[i]
                                WtSetPlace(cb, tmp)
                                WtSetPlace(label, tmp)
                                WtSetPlace(label, { posX = tmp.posX + 31 })
                            elseif (#(v.params.options) == 4) then
                                local tmp = ITEM_SETTING_CB_POS[i]
                                WtSetPlace(cb, tmp)
                                WtSetPlace(label, tmp)
                                WtSetPlace(label, { posX = tmp.posX + 31 })
                            end

                            if (UI_SETTINGS[id].cb[option.name] == nil) then
                                UI_SETTINGS[id].cb[option.name] = option.value
                            end

                            cb:SetVariant(ToVariant(UI_SETTINGS[id].cb[option.name]))
                        end
                    end

                    enable:SetVariant(ToVariant(UI_SETTINGS[id].value))
                    -- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
                    -- =-                 B U T T O N                 -=
                    -- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
                elseif (v.type == "Button") then
                    local panel = CreateWG("ButtonPanel", "ButtonPanel", groupFrame, true,
                        {
                            alignX = 2,
                            posX = 1,
                            sizeX = maxW,
                            posY = minPosY + verticalIndex * 45 + extraPadding,
                            highPosX = 0,
                            alignY = 0
                        })
                    local button = panel:GetChildChecked("Button", true)
                    local label = panel:GetChildChecked("ButtonPanelText", false)
                    groupFrame:AddChild(panel)
                    if (v.customClass ~= nil) then
                        label:SetClassVal("class", v.customClass)
                    else
                        label:SetClassVal("class", "Golden")
                    end
                    label:SetVal("text", tostring(v.label))
                    button:SetName(id)
                    WtSetPlace(button, { sizeX = v.params.options.width })

                    if (not UI_SETTINGS[id]) then
                        UI_SETTINGS[id] = {
                            type = v.type,
                            value = v.params.value,
                            defaultState = v.params.defaultState,
                            callback = v.params.callback,
                            states = v.params.states,
                            state = v.params.state
                        }
                    end

                    button:SetVal("label", ToWS(GetLocaleText(tostring(UI_SETTINGS[id].value))))
                    UI_SETTINGS[id].callback = v.params.callback

                    -- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
                    -- =-           B U T T O N   I N P U T           -=
                    -- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
                elseif (v.type == "ButtonInput") then
                    local panel = CreateWG("ButtonInputPanel", "ButtonInputPanel", groupFrame, true,
                        {
                            alignX = 2,
                            posX = 1,
                            sizeX = maxW,
                            posY = minPosY + verticalIndex * 45 + extraPadding,
                            highPosX = 0,
                            alignY = 0
                        })
                    local button = panel:GetChildChecked("Button", true)
                    local label = panel:GetChildChecked("ButtonInputPanelText", false)
                    groupFrame:AddChild(panel)
                    if (v.customClass ~= nil) then
                        label:SetClassVal("class", v.customClass)
                    else
                        label:SetClassVal("class", "Golden")
                    end
                    label:SetVal("text", v.label)
                    button:SetName(id)
                    WtSetPlace(button, { sizeX = v.params.options.width })

                    if (not UI_SETTINGS[id]) then
                        UI_SETTINGS[id] = {
                            type = v.type,
                            value = v.params.value,
                            defaultState = v.params.defaultState,
                            callback = v.params.callback,
                            states = v.params.states,
                            state = v.params.state
                        }
                    end

                    button:SetVal("label", ToWS(GetLocaleText(UI_SETTINGS[id].value)))
                    UI_SETTINGS[id].callback = v.params.callback
                    -- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
                    -- =-                   L I S T                   -=
                    -- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
                elseif (v.type == "List") then
                    local panel = CreateWG("ListPanel", "ListPanel", groupFrame, true,
                        {
                            alignX = 2,
                            posX = 1,
                            sizeX = maxW,
                            posY = minPosY + verticalIndex * 45 + extraPadding,
                            highPosX = 0,
                            alignY = 0
                        })
                    local label = panel:GetChildChecked("ListPanelText", false)
                    local valueLabel = panel:GetChildChecked("ListPanelDescText", true)
                    local lBtn = panel:GetChildChecked("ListPanelButtonLeft", true)
                    local rBtn = panel:GetChildChecked("ListPanelButtonRight", true)
                    groupFrame:AddChild(panel)
                    if (v.customClass ~= nil) then
                        label:SetClassVal("class", v.customClass)
                    else
                        label:SetClassVal("class", "Golden")
                    end
                    label:SetVal("list_text", v.label)
                    lBtn:SetName(id)
                    rBtn:SetName(id)

                    if (not UI_SETTINGS[id]) then
                        UI_SETTINGS[id] = {
                            type = v.type,
                            value = v.params.value,
                            defaultIndex = v.params.defaultIndex,
                            index = v.params.index,
                            options = v.params.options,
                            cycle = v.params.cycle
                        }
                    end

                    local tmp = tostring(UI_SETTINGS[id].value)
                    valueLabel:SetVal("text", tmp)

                    if (COLOR_CLASSES and COLOR_CLASSES[tmp]) then
                        valueLabel:SetClassVal("class", tmp)
                    else
                        valueLabel:SetClassVal("class", "tip_white")
                        tmp = GetLocaleText(tmp)
                    end

                    valueLabel:SetVal("text", tmp)

                    lBtn:Enable(v.params.cycle or UI_SETTINGS[id].index > 1)
                    rBtn:Enable(v.params.cycle or UI_SETTINGS[id].index < #(UI_SETTINGS[id].options))

                    UI_SETTINGS[id].widgets = {
                        lBtn = lBtn, rBtn = rBtn, value = panel:GetChildChecked("ListPanelDescText", true)
                    }
                    -- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
                    -- =-                 S L I D E R                 -=
                    -- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
                elseif (v.type == "Slider") then
                    local panel = CreateWG("SliderPanel", "SliderPanel", groupFrame, true,
                        {
                            alignX = 2,
                            posX = 1,
                            sizeX = maxW,
                            posY = minPosY + verticalIndex * 45 + extraPadding,
                            highPosX = 0,
                            alignY = 0
                        })
                    local label = panel:GetChildChecked("SliderPanelText", false)
                    local discreteSlider = panel:GetChildChecked("DiscreteSlider", true)
                    local barPanel = panel:GetChildChecked("SliderPanelBar", true)
                    local valueLabel = barPanel:GetChildChecked("SliderPanelBarText", true)

                    groupFrame:AddChild(panel)
                    if (v.customClass ~= nil) then
                        label:SetClassVal("class", v.customClass)
                    else
                        label:SetClassVal("class", "Golden")
                    end
                    label:SetVal("slider_text", v.label)
                    WtSetPlace(barPanel, { sizeX = (v.params.options.width + 61) })
                    discreteSlider:SetStepsCount(v.params.options.stepsCount)
                    discreteSlider:SetName(id)

                    if (not UI_SETTINGS[id]) then
                        UI_SETTINGS[id] = {
                            type = v.type,
                            value = v.params.value,
                            defaultValue = v.params.defaultValue,
                            offset = v.params.options.offset or 0
                        }
                    end

                    discreteSlider:SetPos(UI_SETTINGS[id].value)
                    valueLabel:SetVal("text", tostring(UI_SETTINGS[id].value + (UI_SETTINGS[id].offset or 0)))
                    -- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
                    -- =-                  I N P U T                  -=
                    -- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
                elseif (v.type == "Input") then
                    local panel = CreateWG("InputPanel", "InputPanel", groupFrame, true,
                        {
                            alignX = 2,
                            posX = 1,
                            sizeX = maxW,
                            posY = minPosY + verticalIndex * 45 + extraPadding,
                            highPosX = 0,
                            alignY = 0
                        })
                    local label = panel:GetChildChecked("InputPanelText", false)
                    groupFrame:AddChild(panel)
                    if (v.customClass ~= nil) then
                        label:SetClassVal("class", v.customClass)
                    else
                        label:SetClassVal("class", "Golden")
                    end
                    label:SetVal("text", v.label)
                    local inputBg = panel:GetChildChecked("InputPanelBg", true)
                    WtSetPlace(inputBg, { sizeX = (v.params.options.width) })
                    local editLine = panel:GetChildChecked("EditLine" .. v.params.options.filter, true)
                    editLine:SetMaxSize(v.params.options.maxChars)
                    editLine:SetMaxSize(v.params.options.maxChars)
                    editLine:Show(true)
                    editLine:Enable(true)
                    editLine:SetName(id)

                    if (not UI_SETTINGS[id]) then
                        UI_SETTINGS[id] = {
                            type = v.type,
                            value = v.params.value,
                            defaultValue = v.params.defaultValue,
                            filter = v.params.options.filter
                        }
                    end

                    editLine:SetText(ToWS(UI_SETTINGS[id].value))
                end
                ::renderContinue::
            end
        end

        -- printSettings()
        if (TAB_SHOW) then
            scrollCont:PushBack(groupFrame)
        else
            groupFrame:Show(false)
        end
    end
end
